<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ResQ 112 - Wearable & Emergency Contacts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet"/>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

  <style>
    :root {
        --bg-color: #000000; --bg-image: none; --globe-bg-color: #000000;
        --text-color: #e0e0e0; --text-color-light: #fff; --text-highlight-glow: #00ffff;
        --glow-button-text: #000; --hr-color: rgba(0, 255, 255, 0.2);
        --glass-card-bg: rgba(255,255,255,0.05); --glass-card-border: rgba(255,255,255,0.1);
        --input-bg: rgba(0,0,0,0.4);
        --primary-font: 'Exo 2', sans-serif; --secondary-font: 'Space Grotesk', sans-serif;
    }
    body.light-theme {
        --bg-color: #eaf2f8; --bg-image: radial-gradient(circle at 10% 10%, #ffffff 0%, #eaf2f8 80%);
        --globe-bg-color: #f5f7fa; --text-color: #34495e; --text-color-light: #1c2833;
        --text-highlight-glow: #0056b3; --glow-button-text: #fff; --hr-color: rgba(0, 86, 179, 0.2);
        --glass-card-bg: rgba(255,255,255,0.6); --glass-card-border: rgba(220,220,220,0.8);
        --input-bg: rgba(0,0,0,0.05);
    }
    body {
        font-family: var(--secondary-font); margin: 0; overflow: hidden;
        background-color: var(--bg-color); background-image: var(--bg-image);
    }
    #star-background-canvas {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        z-index: 1; transition: opacity 0.5s ease;
    }
    body.light-theme #star-background-canvas { opacity: 0; pointer-events: none; }
    .main-container { display: flex; width: 100vw; height: 100vh; position: relative; z-index: 2; }
    #scene-container {
        flex-shrink: 0; flex-basis: 50%; height: 100%; position: relative;
        background-color: var(--globe-bg-color);
        transition: background-color 0.5s ease, flex-basis 0.7s ease-in-out;
    }
    .content-container {
        flex-grow: 1; height: 100%; display: flex; flex-direction: column;
        justify-content: flex-start; /* Align to top */
        padding: 1.5rem 2rem; box-sizing: border-box; background: transparent;
        color: var(--text-color); overflow-y: auto; /* Allow scrolling */
    }
    .logo-container {
        position: absolute; top: 1.5rem; left: 2rem; z-index: 3;
        display: flex; align-items: center; gap: 0.75rem;
    }
    .logo-container img { height: 60px; width: 60px; } 
    .logo-container span { font-family: var(--secondary-font); font-weight: 700; font-size: 2rem; color: var(--text-color-light); }
    #theme-switcher {
        background: none; border: 1px solid var(--hr-color); border-radius: 50%; width: 40px; height: 40px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        padding: 8px; color: var(--text-color-light);
    }
    #theme-switcher svg { width: 100%; height: 100%; }
    .sun-icon { display: none; }
    body.light-theme .moon-icon { display: none; }
    body.light-theme .sun-icon { display: block; }
    .glass-card {
        background: var(--glass-card-bg); backdrop-filter:blur(10px); border:1px solid var(--glass-card-border);
        transition:all .3s ease; color: var(--text-color);
    }
    .glow-button {
        background-color: var(--text-highlight-glow); color: var(--glow-button-text); font-weight: 700;
        box-shadow: 0 0 8px var(--text-highlight-glow), 0 0 20px var(--text-highlight-glow);
        transition:all .3s ease;
    }
    .glow-button:hover{box-shadow:0 0 15px var(--text-highlight-glow),0 0 35px var(--text-highlight-glow);}
    .content-container input { background-color: var(--input-bg); border-color: var(--glass-card-border); }
    .content-container h1, .content-container h2 { color: var(--text-color-light); }

    /* Responsive styles for mobile */
    @media (max-width: 768px) {
        .main-container { flex-direction: column; }
        #scene-container { flex-basis: 40vh !important; }
        .content-container { flex-basis: 60vh !important; }
        .dashboard-header { flex-direction: column; gap: 1rem; }
    }
  </style>
  <script>
    (function() {
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'light') { document.body.classList.add('light-theme'); }
    })();
  </script>
</head>
<body>
    <canvas id="star-background-canvas"></canvas>

    <div class="main-container">
        <div id="scene-container">
             <div class="logo-container">
                <img src="logo.png.png" alt="ResQ 112 Logo" />
                <span>ResQ 112</span>
            </div>
        </div>
        
        <div class="content-container">
            <header class="w-full mb-6 flex justify-between items-center dashboard-header">
                <h1 class="text-3xl font-bold">⌚ Wearable & Contacts</h1>
                <div class="flex items-center gap-4">
                    <a href="dashboard.html" class="text-sm hover:text-cyan-400">Back to Dashboard</a>
                    <button id="theme-switcher" title="Toggle theme">
                        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.894 17.894a.75.75 0 011.06 0l1.59 1.591a.75.75 0 11-1.06 1.06l-1.591-1.59a.75.75 0 010-1.06zM12 21a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 21zM5.106 17.894a.75.75 0 010-1.06l1.591-1.59a.75.75 0 111.06 1.06l-1.59 1.591a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 5.106a.75.75 0 011.06 0l1.59 1.591a.75.75 0 11-1.06 1.06l-1.591-1.59a.75.75 0 010-1.06z"></path></svg>
                        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.51 1.713-6.625 4.43-8.56a.75.75 0 01.818.162z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </header>
            
            <main class="w-full max-w-lg mx-auto flex flex-col items-center gap-6">
                <div class="glass-card w-full text-center p-6 rounded-xl">
                    <p class="mb-4">Connect your smartwatch / wearable device via Bluetooth to receive real-time notifications & SOS alerts.</p>
                    <button id="connectBtn" class="bg-cyan-500 text-black px-6 py-3 rounded-lg glow-button">Connect Wearable</button>
                </div>

                <div id="deviceInfo" class="glass-card w-full hidden p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-3">Device Info</h2>
                    <p><b>Name:</b> <span id="deviceName">—</span></p>
                    <p><b>ID:</b> <span id="deviceId">—</span></p>
                    <p><b>Status:</b> <span id="deviceStatus" class="text-green-400">Connected</span></p>
                    <button id="sendTest" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg glow-button">Send Test Notification</button>
                </div>

                <div id="sosAlert" class="glass-card w-full hidden text-center border border-red-500 p-6 rounded-xl">
                    <h2 class="text-xl font-bold text-red-400 mb-2">🚨 SOS Alert Received!</h2>
                    <p id="sosDetails">User in danger. Location available.</p>
                    <a id="sosMapLink" href="#" target="_blank" class="mt-3 inline-block bg-red-600 text-white px-4 py-2 rounded glow-button">Open in Google Maps</a>
                </div>

                <div class="glass-card w-full mt-2 p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-4">📞 Emergency Contacts</h2>
                    <form id="contactsForm" class="flex flex-col gap-3">
                        <div><input type="text" placeholder="Name 1" id="name1" class="w-full p-2 rounded">
                            <input type="text" placeholder="Phone 1" id="phone1" class="w-full p-2 rounded mt-1"></div>
                        <div><input type="text" placeholder="Name 2" id="name2" class="w-full p-2 rounded">
                            <input type="text" placeholder="Phone 2" id="phone2" class="w-full p-2 rounded mt-1"></div>
                        <div><input type="text" placeholder="Name 3" id="name3" class="w-full p-2 rounded">
                            <input type="text" placeholder="Phone 3" id="phone3" class="w-full p-2 rounded mt-1"></div>
                        <div><input type="text" placeholder="Name 4" id="name4" class="w-full p-2 rounded">
                            <input type="text" placeholder="Phone 4" id="phone4" class="w-full p-2 rounded mt-1"></div>
                        <div><input type="text" placeholder="Name 5" id="name5" class="w-full p-2 rounded">
                            <input type="text" placeholder="Phone 5" id="phone5" class="w-full p-2 rounded mt-1"></div>
                        <button type="submit" class="mt-4 bg-cyan-500 text-black px-4 py-2 rounded glow-button">Save Contacts</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        // --- 3D SCENE SETUP ---
        let globeScene, globeCamera, globeRenderer, earthModel, atmosphere;
        const globeContainer = document.getElementById('scene-container');
        function initGlobeScene() {
            globeScene = new THREE.Scene();
            globeCamera = new THREE.PerspectiveCamera(50, globeContainer.clientWidth / globeContainer.clientHeight, 0.1, 1000);
            globeCamera.position.set(0, 0, 4);
            const globeCanvas = document.createElement('canvas');
            globeContainer.appendChild(globeCanvas);
            globeRenderer = new THREE.WebGLRenderer({ canvas: globeCanvas, antialias: true, alpha: true });
            globeRenderer.setSize(globeContainer.clientWidth, globeContainer.clientHeight);
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            globeScene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 3.0);
            directionalLight.position.set(-5, 3, 5);
            globeScene.add(directionalLight);
            const atmosphereGeometry = new THREE.SphereGeometry(1, 64, 64);
            const atmosphereMaterial = new THREE.MeshBasicMaterial({ color: 0xadd8e6, transparent: true, opacity: 0.15, blending: THREE.AdditiveBlending });
            atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
            globeScene.add(atmosphere);
            const loader = new THREE.GLTFLoader();
            loader.load('earth.glb', (gltf) => {
                earthModel = gltf.scene;
                earthModel.scale.set(0.01, 0.01, 0.01);
                globeScene.add(earthModel);
                atmosphere.scale.set(0.0105, 0.0105, 0.0105);
            });
        }
        let starScene, starCamera, starRenderer, stars;
        const starCanvas = document.getElementById('star-background-canvas');
        function initStarScene() {
            starScene = new THREE.Scene();
            starCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            starCamera.position.z = 5;
            starRenderer = new THREE.WebGLRenderer({ canvas: starCanvas, antialias: true });
            starRenderer.setSize(window.innerWidth, window.innerHeight);
            const starTexture = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAApgAAAKYB3X3/OAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFGSURBVFiF7dexSsNQFEDwZ0hQG4toYy2CvYRg8Qe0sVDs1Z2FrxJ/gD+kg4jgE/iB4E/Y2llE2yA2tvYJssu4mGj8IIYg+CY788bce98HcScG2oV2Uhv34b07wZ86fA28BF5VlWkATwCHwF3gG/C0qb8r4ApwC7wA3gEHwAXgGfCpqgfwKPCUqgF8BF4Cj4BdwANwDTgAvgK3gevAsqq+g14C/wHvgS/A64HKDqgHwGPgVlU/geuA+gB8AbwLPAASADwADgGHgGfA44BvgHOADMBDAAcAs74F0gKMBK4BfwCLgI/AVGAi0A/gK3AWOA7MBS4ADgG7gZvAM+AycBA4A9wCDgG/gGfAJ+AD8An4AEwBnoCnwAvgQzADfAEOAV+Ay8Bp4DZwGfgL/ARuBq4DA4E5wA/gL/A/gA3gK/AXuBG4C5wD/gBfBf6A/zYDKwPd358GfAFaMdwuC4KyoQAAAABJRU5ErkJggg==');
            const positions = [];
            for (let i = 0; i < 10000; i++) {
                positions.push((Math.random() - 0.5) * 200, (Math.random() - 0.5) * 200, (Math.random() - 0.5) * 200);
            }
            const starGeo = new THREE.BufferGeometry();
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({ size: 0.05, map: starTexture, transparent: true, alphaTest: 0.5 });
            stars = new THREE.Points(starGeo, starMat);
            starScene.add(stars);
        }
        function onWindowResize() {
            if (globeContainer.clientWidth > 0) {
                globeCamera.aspect = globeContainer.clientWidth / globeContainer.clientHeight;
                globeCamera.updateProjectionMatrix();
                globeRenderer.setSize(globeContainer.clientWidth, globeContainer.clientHeight);
            }
            starCamera.aspect = window.innerWidth / window.innerHeight;
            starCamera.updateProjectionMatrix();
            starRenderer.setSize(window.innerWidth, window.innerHeight);
        }
        function animate() {
            requestAnimationFrame(animate);
            if (earthModel) {
                earthModel.rotation.y += 0.001;
                atmosphere.rotation.y += 0.001;
            }
            globeRenderer.render(globeScene, globeCamera);
            if (stars) { stars.rotation.y += 0.0001; }
            starRenderer.render(starScene, starCamera);
        }

        // --- THEME SWITCHER LOGIC ---
        const themeSwitcher = document.getElementById('theme-switcher');
        themeSwitcher.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
            localStorage.setItem('theme', currentTheme);
        });
        
        // --- WEARABLE PAGE LOGIC (PRESERVED) ---
        const firebaseConfig={ apiKey:"AIzaSyBcLtaRPt6hTo4aEFRvcBwNq5-00soEjB4", authDomain:"sos-c1499.firebaseapp.com", databaseURL:"https://sos-c1499-default-rtdb.asia-southeast1.firebasedatabase.app", projectId:"sos-c1499", storageBucket:"sos-c1499.appspot.com", messagingSenderId:"1008729495848", appId:"1:1008729495848:web:7d6c7d3a6047e2736e981d", measurementId:"G-JGBY3ZZPGC" };
        firebase.initializeApp(firebaseConfig);
        const db=firebase.database();
        const connectBtn=document.getElementById("connectBtn"), deviceInfo=document.getElementById("deviceInfo"), deviceName=document.getElementById("deviceName"), deviceId=document.getElementById("deviceId"), sendTest=document.getElementById("sendTest"), sosAlert=document.getElementById("sosAlert"), sosDetails=document.getElementById("sosDetails"), sosMapLink=document.getElementById("sosMapLink");
        connectBtn.addEventListener("click",async()=>{
          try{
            const device=await navigator.bluetooth.requestDevice({acceptAllDevices:true});
            deviceName.innerText=device.name||"Unknown Device"; deviceId.innerText=device.id;
            deviceInfo.classList.remove("hidden");
            const uid=localStorage.getItem("userId")||"guest";
            db.ref("wearables/"+uid).set({ deviceName:device.name, deviceId:device.id, connectedAt:Date.now() });
          }catch(err){console.error("Bluetooth error:",err);}
        });
        sendTest.addEventListener("click",()=>{ alert("🔔 Test notification sent (simulation)"); });
        const contactsForm=document.getElementById("contactsForm");
        contactsForm.addEventListener("submit",e=>{
          e.preventDefault();
          const uid=localStorage.getItem("userId")||"guest"; const contacts=[];
          for(let i=1;i<=5;i++){
            const name=document.getElementById("name"+i).value.trim();
            const phone=document.getElementById("phone"+i).value.trim();
            if(name && phone){ contacts.push({name,phone}); }
          }
          db.ref("contacts/"+uid).set(contacts).then(()=>alert("✅ Emergency contacts saved")).catch(err=>alert("❌ Failed: "+err));
        });

        // --- INITIALIZE EVERYTHING ---
        initGlobeScene();
        initStarScene();
        window.addEventListener('resize', onWindowResize);
        animate();
    </script>
</body>
</html>